{% extends 'base.html' %}

{% block title %}
  Page de connexion
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<!-- Modal déjà connecté -->
<div class="modal fade" id="alreadyLoggedModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-success">
      <div class="modal-header">
        <h5 class="modal-title text-success">Déjà connecté</h5>
      </div>
      <div class="modal-body">
        Vous êtes déjà connecté. Redirection vers l'accueil en cours...
      </div>
      <div class="modal-footer">
        <a href="{% url 'core:index' %}" class="btn btn-success">Aller à l’accueil maintenant</a>
      </div>
    </div>
  </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = new bootstrap.Modal(document.getElementById("alreadyLoggedModal"));
        modal.show();
        // Redirection automatique après 2 secondes
        setTimeout(() => {
            window.location.href = "{% url 'core:index' %}";
        }, 2000);
    });
</script>

{% else %}
  <div class="container py-5">
    <!-- Présentation du coach -->
    <div class="text-center mb-5">
      <h1 class="display-4">Page de Connexion</h1>
    </div>

    <!-- Formulaire de connexion -->
    <section class="mb-5">
      <form method="post">
        {% csrf_token %}

        {% for field in form %}
          <div class="mb-3">
            {{ field.label_tag }}
            {{ field }}
            {% if field.errors %}
              <div class="text-danger small">{{ field.errors|striptags }}</div>
            {% endif %}
          </div>
        {% endfor %}

        <button type="submit" class="btn btn-primary">Se connecter</button>

        <p>Vous n'avez pas de compte ? <a href="{% url 'accounts:signup' %}" class="link-info link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Inscrivez-vous</a></p>
      </form>
    </section>

    <!-- Messages d'erreur -->
    <section class="mb-5">
      <!-- TOAST Bootstrap -->
      {% for message in messages %}
        {% if message.tags == 'error' %}
          <div class="toast align-items-center text-white bg-danger border-0 show" role="alert">
            <div class="d-flex">
              <div class="toast-body">{{ message }}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Fermer"></button>
            </div>
          </div>
        {% endif %}
      {% endfor %}

      <script>
        // Auto-hide toasts après 3 secondes
        document.addEventListener('DOMContentLoaded', function () {
          const toastElList = [].slice.call(document.querySelectorAll('.toast.bg-danger'))
          toastElList.forEach(function (toastEl) {
            const toast = new bootstrap.Toast(toastEl, { delay: 2500 })
            toast.show()
          })
        })
      </script>
    </section>
  </div>
  {% endif %}
{% endblock %}
